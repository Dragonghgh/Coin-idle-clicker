<script>
  let coins = 0;
  let coinsPerSecond = 0;
  let upgradeCost = 50;
  let lastSaveTime = Date.now();

  function loadGame() {
    const saved = JSON.parse(localStorage.getItem('idleClickerGame'));
    if (saved) {
      coins = saved.coins || 0;
      coinsPerSecond = saved.coinsPerSecond || 0;
      upgradeCost = saved.upgradeCost || 50;
      lastSaveTime = saved.lastSaveTime || Date.now();

      // ⏰ Offline earnings
      const now = Date.now();
      const secondsOffline = Math.floor((now - lastSaveTime) / 1000);
      const offlineEarnings = coinsPerSecond * secondsOffline;

      if (offlineEarnings > 0) {
        alert(`Welcome back! You earned ${offlineEarnings} coins while you were away.`);
        coins += offlineEarnings;
      }
    }
  }

  function saveGame() {
    const gameData = {
      coins,
      coinsPerSecond,
      upgradeCost,
      lastSaveTime: Date.now() // Save the time each time we save
    };
    localStorage.setItem('idleClickerGame', JSON.stringify(gameData));
  }

  function clickCoin() {
    coins += 1;
    updateDisplay();
    saveGame();
  }

  function buyUpgrade() {
    if (coins >= upgradeCost) {
      coins -= upgradeCost;
      coinsPerSecond += 1;
      upgradeCost = Math.floor(upgradeCost * 1.5);
      updateDisplay();
      saveGame();
    }
  }

  function updateDisplay() {
    document.getElementById('coins').textContent = coins;
    document.getElementById('cps').textContent = coinsPerSecond;
    document.getElementById('cost').textContent = upgradeCost;
  }

  function resetGame() {
    localStorage.removeItem('idleClickerGame');
    coins = 0;
    coinsPerSecond = 0;
    upgradeCost = 50;
    updateDisplay();
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('coin').addEventListener('click', clickCoin);
    loadGame();
    updateDisplay();
  });

  setInterval(() => {
    coins += coinsPerSecond;
    updateDisplay();
    saveGame();
  }, 1000);
</script>
